---
目的: main の最新変更を取り込み、RM-047 対応の前提を更新する
関連ブランチ: feat/rm047-draft-structuring
関連Issue: #264
roadmap_item: RM-047 テンプレ統合構成生成AI連携
---

- [x] ブランチ作成と初期コミット
  - メモ: feat/rm047-draft-structuring を main から作成済み
- [x] 計画策定（スコープ・前提の整理）
  - メモ: 
      - **対象整理**  
        - スコープ: main 最新変更の取り込みと RM-047 向け設計・実装前提の整合確認に限定。機能仕様の追加・削除は行わない。  
        - 対象: `feat/rm047-draft-structuring` ブランチ、`docs/design/draft-structuring-RM047.md` ほか RM-047 関連ドキュメント。  
        - 前提: main で大幅改訂がマージ済みであり、今後の RM-047 実装はその状態を基準とする。  
      - **実施手順**  
        1. `main` の最新差分と関連ドキュメントを確認し、RM-047 作業に影響する変更点を洗い出す。  
        2. `feat/rm047-draft-structuring` ブランチへ `main` をマージし、競合解消とビルド・テスト整合を確認する。  
        3. マージ後の状態を前提に、RM-047 向け設計ドキュメントとチェックリストの前提更新が必要か確認し、必要な反映箇所を整理する。  
      - **想定影響ファイル**: `src/pptx_generator/**`, `docs/design/**`, `docs/requirements/**`, `.github/workflows/**`（main 側更新の追従確認用）  
      - **リスク**: 競合多発による作業停滞、main 側仕様変更の見落とし、マージ後テスト失敗。  
      - **テスト方針**: `uv run --extra dev pytest` を最小実行。必要に応じて `ruff`／`black --check`／`mypy` で整合確認。  
      - **ロールバック**: マージコミットを `git reset --hard HEAD^` で戻した上で、再度 main 取り込み手順をやり直す。  
      - **承認メッセージ**: ユーザー発言「ok, todoに上記planの転記と、checklistの作成よろしくね」（本スレッド）。
- [x] 設計・実装方針の確定
  - メモ: main 取り込み後の前提整理を完了し、`generate_ready` 基盤への移行方針は `docs/design/stages/stage-03-mapping.md` 更新（commit `edfabde`）および `docs/design/design.md` 反映済み。旧 `docs/design/draft-structuring-RM047.md` は削除済みで、再配置議論は `docs/design/stages/` 系へ統合する方針で確定。
- [x] ドキュメント更新（要件・設計）
  - メモ: main 取り込みに伴う前提差分を `docs/requirements/stages/stage-03-mapping.md`・`docs/design/stages/stage-03-mapping.md` 等へ反映済み（commit `edfabde`）。
  - [x] docs/requirements 配下
    - メモ: Stage3 要件を `generate_ready` 基盤へ更新（commit `edfabde`）。
  - [x] docs/design 配下
    - メモ: Stage3 設計・CLI 説明を整理（commit `edfabde`）。
- [x] 実装
  - メモ: `git merge origin/main` を実行し、`docs/design/design.md`・`docs/requirements/stages/stage-04-draft-structuring.md` の競合を main 優先で解消。`chore(merge): sync latest main into rm047` (8118ea8) を作成。
- [x] テスト・検証
  - メモ: `uv run --extra dev pytest` を実行し 145 件成功。マージ後の退行は無し。
- [x] ドキュメント更新
  - メモ: main 取り込み影響を全体確認し、ロードマップ／README／runbook の該当箇所を `generate_ready` 基盤へ更新済み（commits `6a12b63`, `c00d319`）。
  - [x] docs/roadmap 配下
    - メモ: 工程3説明および RM-024 期待成果を最新仕様へ更新（commit `c00d319`）。
  - [x] docs/requirements 配下（実装結果との整合再確認）
    - メモ: Stage3 要件の整合を確認済み。
  - [x] docs/design 配下（実装結果との整合再確認）
    - メモ: Stage3 設計・CLI リファレンスの整合を確認済み。
  - [x] docs/runbook 配下
    - メモ: `story-outline-ops` を最新フローへ更新（commit `6a12b63`）。
  - [x] README.md / AGENTS.md
    - メモ: README 工程3説明を刷新（commit `6a12b63`）。
- [x] 関連Issue 行の更新
  - メモ: 
- [x] PR 作成
  - メモ: PR #282 https://github.com/yurake/pptx_generator/pull/282（2025-11-09 完了）

## メモ
- main 側で `prepare_card.json` への名称統一、テンプレ工程統合 CLI (`uv run pptx template`) が導入済み。RM-047 実装時は新ステージ構成（Stage2/Stage3/Stage4 再定義）と整合を取りながら `generate_ready` 置換を行う。
- `docs/design/draft-structuring-RM047.md` が main から削除されているため、再設計版をどこへ配置するか（`docs/design/stages/` に統合する等）を設計フェーズで決定する。
- `tests/test_cli_integration.py` など CLI 関連テストが大幅更新されている。`generate_ready` 周辺の改修時は新テスト構成を前提に追加ケースを検討する。
