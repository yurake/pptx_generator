---
目的: main の最新変更を取り込み、RM-047 対応の前提を更新する
関連ブランチ: feat/rm047-draft-structuring
関連Issue: #264
roadmap_item: RM-047 テンプレ統合構成生成AI連携
---

- [x] ブランチ作成と初期コミット
  - メモ: feat/rm047-draft-structuring を main から作成済み
- [x] 計画策定（スコープ・前提の整理）
  - メモ: 
      - **対象整理**  
        - スコープ: main 最新変更の取り込みと RM-047 向け設計・実装前提の整合確認に限定。機能仕様の追加・削除は行わない。  
        - 対象: `feat/rm047-draft-structuring` ブランチ、`docs/design/draft-structuring-RM047.md` ほか RM-047 関連ドキュメント。  
        - 前提: main で大幅改訂がマージ済みであり、今後の RM-047 実装はその状態を基準とする。  
      - **実施手順**  
        1. `main` の最新差分と関連ドキュメントを確認し、RM-047 作業に影響する変更点を洗い出す。  
        2. `feat/rm047-draft-structuring` ブランチへ `main` をマージし、競合解消とビルド・テスト整合を確認する。  
        3. マージ後の状態を前提に、RM-047 向け設計ドキュメントとチェックリストの前提更新が必要か確認し、必要な反映箇所を整理する。  
      - **想定影響ファイル**: `src/pptx_generator/**`, `docs/design/**`, `docs/requirements/**`, `.github/workflows/**`（main 側更新の追従確認用）  
      - **リスク**: 競合多発による作業停滞、main 側仕様変更の見落とし、マージ後テスト失敗。  
      - **テスト方針**: `uv run --extra dev pytest` を最小実行。必要に応じて `ruff`／`black --check`／`mypy` で整合確認。  
      - **ロールバック**: マージコミットを `git reset --hard HEAD^` で戻した上で、再度 main 取り込み手順をやり直す。  
      - **承認メッセージ**: ユーザー発言「ok, todoに上記planの転記と、checklistの作成よろしくね」（本スレッド）。
- [ ] 設計・実装方針の確定
  - メモ: main 取り込みの結果、工程2 出力が `prepare_card.json` 系へ名称統一され、CLI `pptx outline` が `draft_*` 出力を維持したまま大規模改訂された。RM-047 実装ではこれら新前提を踏まえ、`generate_ready` 置換計画と章テンプレ連携の整理が必要。`docs/design/draft-structuring-RM047.md` は main から除外されているため、再設計ドキュメントの再配置方針を検討する。
- [ ] ドキュメント更新（要件・設計）
  - メモ: 
  - [ ] docs/requirements 配下
  - [ ] docs/design 配下
- [x] 実装
  - メモ: `git merge origin/main` を実行し、`docs/design/design.md`・`docs/requirements/stages/stage-04-draft-structuring.md` の競合を main 優先で解消。`chore(merge): sync latest main into rm047` (8118ea8) を作成。
- [x] テスト・検証
  - メモ: `uv run --extra dev pytest` を実行し 145 件成功。マージ後の退行は無し。
- [ ] ドキュメント更新
  - メモ: main 取り込みで前提が変わった箇所（設計・要件・ロードマップ等）があれば差分を反映し、変更不要の判断を行った場合も理由を記録する。
  - [ ] docs/roadmap 配下
  - [ ] docs/requirements 配下（実装結果との整合再確認）
  - [ ] docs/design 配下（実装結果との整合再確認）
  - [ ] docs/runbook 配下
  - [ ] README.md / AGENTS.md
- [x] 関連Issue 行の更新
  - メモ: 
- [ ] PR 作成
  - メモ: 

## メモ
- main 側で `prepare_card.json` への名称統一、テンプレ工程統合 CLI (`uv run pptx template`) が導入済み。RM-047 実装時は新ステージ構成（Stage2/Stage3/Stage4 再定義）と整合を取りながら `generate_ready` 置換を行う。
- `docs/design/draft-structuring-RM047.md` が main から削除されているため、再設計版をどこへ配置するか（`docs/design/stages/` に統合する等）を設計フェーズで決定する。
- `tests/test_cli_integration.py` など CLI 関連テストが大幅更新されている。`generate_ready` 周辺の改修時は新テスト構成を前提に追加ケースを検討する。
