---
目的: AI生成コンテンツに対して、生成元を示すフッタを自動付与する機能を実装し、透明性とトレーサビリティを向上させる
関連ブランチ: feat/rm-055-ai-footer
関連Issue: #TBD
roadmap_item: RM-055 AI生成文言フッタ自動付与
---

- [x] ブランチ作成と初期コミット
  - メモ: ブランチ `feat/rm-055-ai-footer` を main から作成し、ToDoファイルの関連ブランチを更新
    - 初期コミット: b56758a "docs: add todo for RM-055 AI-generated content footer"
- [x] 計画策定（スコープ・前提の整理）
  - メモ: 承認済み Plan を転記（2025-11-13 完了）
    - 対象整理（スコープ、対象ファイル、前提）: AI生成コンテンツへのフッタ自動付与機能を実装。Polisher処理でAI生成コンテンツを判別し、指定文言のフッタを自動追加。フッタ文言はポリシー設定ファイルで管理。
    - ドキュメント／コード修正方針: Polisherにフッタ付与ロジックを追加。AI生成メタデータを参照して対象スライドを判定。設定ファイルでフッタ文言・検出条件を管理し、ON/OFF切替可能にする。
    - 確認・共有方法（レビュー、ToDo 更新など）: 各工程完了時にToDoを更新。単体・統合テストで動作確認。PR作成時に実装内容を共有。
    - 想定影響ファイル:
      - 変更: src/pptx_generator/pipeline/polisher.py（フッタ付与ロジック追加）
      - 新規: config/polisher-rules.json 拡張（AI生成検出条件・フッタ文言記述）
      - テスト: tests/test_polisher.py（単体テスト追加）
      - 統合: tests/test_cli_integration.py（既存テスト拡張）
    - リスク: Polisher既存処理への影響（副作用防止・既存機能非破壊）、フッタ追加による文字数超過リスク、テンプレート側にフッタ用スペース・アンカーが確保されていること、AI生成コンテンツの識別精度
    - テスト方針:
      - 単体テスト: Polisherのフッタ付与ロジック（AI生成判定・文言追加）
      - 統合テスト: CLI経由でのエンドツーエンド動作（PPTX出力・フッタ反映）
      - 検証項目: フッタの正確性、既存機能への非影響、パフォーマンス劣化なし
    - ロールバック方法: フッタ付与機能の無効化オプション（config/polisher-rules.jsonでON/OFF切替）。設定ファイルでフッタ文言・検出条件を空にすることで即時停止可能。
    - 承認メッセージ ID／リンク: （ユーザーから提供された承認メッセージのID/リンクを記載予定）
- [x] 設計（フッタ付与ロジックとポリシー設計）
  - メモ: 以下の設計を確定（2025-11-13完了）
    - **フッタ付与タイミング**: Polisher実行時、既存のOpen XML SDK処理と並行して実施
    - **対象スライド判定**: ai_generation_meta.jsonの存在確認とcards配列からslide_idをマッピング。AI生成コンテンツを含むスライドを特定
    - **設定ファイル構造** (config/polisher-rules.json拡張):
      ```json
      {
        "ai_footer": {
          "enabled": true,
          "text": "※本ページはAI生成コンテンツを含みます",
          "font_size_pt": 8.0,
          "color": "#666666",
          "position": "bottom_right",
          "margin_in": 0.25
        }
      }
      ```
    - **フッタ配置**: スライド右下、既存コンテンツと干渉しない位置に小さいフォントサイズで配置
    - **Polisher統合**: PolisherStepのrun()内で、pptx_path取得後にAI生成メタ情報を読み込み、該当スライドにフッタテキストボックスを追加
    - **エラーハンドリング**: メタファイル不在時は処理をスキップ（警告ログのみ）。設定でenabled=falseの場合も処理スキップ
- [ ] 実装（Polisherへのフッタ付与機能追加）
  - メモ: 実装範囲や未対応事項があれば記載する
  - [ ] Polisherステップへのフッタ付与ロジック追加
  - [ ] AI生成メタデータの判定処理
  - [ ] フッタ文言の生成・配置処理
- [ ] テスト（単体・統合テスト追加）
  - メモ: 実施したテスト内容と結果を記入する
  - [ ] 単体テスト（フッタ付与ロジック）
  - [ ] 統合テスト（CLI実行による動作確認）
- [ ] 関連Issueの更新
  - メモ: フロントマターの `関連Issue` が `未作成` の場合は、対応する Issue 番号（例: `#123`）へ更新する。進捗をissueに書き込むものではない。
- [ ] PR 作成
  - メモ: PR 番号と URL を記録。ワークフローが未動作の場合のみ理由を記載する。todo-auto-complete が自動更新するため手動でチェックしない。

## メモ
- AI生成コンテンツの透明性確保とトレーサビリティ向上が目的
- フッタ付与は Polisher ステップで実施（後処理として追加）
- AI生成メタデータ（ai_generation_meta.json等）を参照してフッタ対象を判定

## 計画策定（Plan）

### 1. スコープ（Scope）
- AI生成コンテンツ（スライドタイトル、本文、箇条書き等）へのフッタ自動付与機能を実装
- Polisher処理でAI生成コンテンツを判別し、指定文言のフッタを自動追加
- フッタ文言はポリシー設定ファイルで管理（例: 「本ページはAI生成コンテンツを含みます」等）

### 2. 影響ファイル
- 変更: [`src/pptx_generator/pipeline/polisher.py`](src/pptx_generator/pipeline/polisher.py:1)（フッタ付与ロジック追加）
- 新規: `config/polisher-rules.json`（AI生成検出条件・フッタ文言記述）
- テスト: [`tests/test_polisher.py`](tests/test_polisher.py:1)（単体テスト追加）
- 統合: [`tests/test_cli_integration.py`](tests/test_cli_integration.py:1)（既存テスト拡張）

### 3. リスクと前提条件
- Polisher既存処理への影響（副作用防止・既存機能非破壊）
- フッタ追加による文字数超過リスク（`rules.json`のmax_length考慮）
- テンプレート側にフッタ用スペース・アンカーが確保されていること
- AI生成コンテンツの識別はモデル名・intentタグ・メタ情報等で判定

### 4. テスト戦略
- 単体テスト: Polisherのフッタ付与ロジック（AI生成判定・文言追加）
- 統合テスト: CLI経由でのエンドツーエンド動作（PPTX出力・フッタ反映）
- 検証項目: フッタの正確性、既存機能への非影響、パフォーマンス劣化なし

### 5. ロールバック方法
- フッタ付与機能の無効化オプション（`config/polisher-rules.json`でON/OFF切替）
- 設定ファイルでフッタ文言・検出条件を空にすることで即時停止可能
