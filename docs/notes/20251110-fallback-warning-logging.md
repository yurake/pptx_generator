# フォールバック発生時の警告ログ要件整理

## 背景
- CLI やパイプラインでは、ユーザー指定が無効だった場合に既定値へフォールバックするケースが複数存在する。
- 現状は `fallback_report.json` など成果物へ記録されるものの、実行ログに警告が出ないため運用時に見落としやすい。
- ユーザーから、フォールバックが発生した際は必ず `WARNING` ログで可視化したいとの要望があった。

## 現行実装の観測
- `MappingStep._apply_capacity_controls`（`src/pptx_generator/pipeline/mapping.py:553`）はレイアウト収容超過を検知すると `MappingFallbackState` に記録し、`fallback_report.json` へ出力するが `logger.warning` は出さない。
- `mapping_log.json` にも `fallback.history` が保存されるが、CLI 標準出力にアラートは出ない。
- ブランド設定や anchor 解決など別のフォールバック箇所でも、既定値使用は静かに処理されるケースが多い。
- 一方で `draft_document artifact の型が不正のため簡易ドラフトを生成します` など、類似状況で `logger.warning` を出している箇所もあり統一されていない。

## 要件整理（提案）
- ユーザー指定の設定・リソースが利用できず、アプリがデフォルトまたは別経路に切り替えた場合は、発生箇所で `logger.warning` を必ず出力する。
  - メッセージにはスライド ID や該当ファイル、切り替え先の概要を含め、`fallback_report.json` と同等以上の可視性を持たせる。
- 複数回のフォールバックが連続した場合は、重複ログが過剰にならないようスライド単位でまとめるなどの工夫を検討する。
- CLI 実行時は `WARNING` レベルが標準出力に出るため、運用者が即座に気付き、ログから根本原因調査を行える。
- テストではフォールバック時に警告ログが出ることをアサートし、リグレッションを防ぐ。

## 次ステップ案
- 新規 RM（仮称: RM-065 フォールバック警告ログ整備）を起票し、対象コンポーネントとログフォーマットを定義する。
- 主要フォールバック箇所（Mapping、Renderer、ブランド設定、テンプレート読み込み等）を棚卸し、警告ログの埋め込みとユニットテストを追加する。
- `docs/runbooks/` や `docs/notes/` に運用観点でのログ確認手順とフォールバック報告の扱いを記載する。
