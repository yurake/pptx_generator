# ロードマップ再設計メモ（2025-10-11）

## 1. ゴールと指標
- 北極星指標: 月次 120 件の自動生成と手戻り率 10% 以下を維持する。
- 品質指標: Analyzer が検知する `critical` issue を 0.5 件/ジョブ以下、品質チェックの自動修正成功率 95% 以上。
- 効率指標: 30 枚構成の PPTX + PDF を 60 秒以内で生成し、テンプレ解析〜生成の全処理をバッチ単体で完結させる。
- 監査指標: 監査ログ欠損率 0%、source_id 付きスライド比率 100%、再生成時間 5 分以内。

## 2. エンドツーエンド工程の整理

| 工程 | オペレーション | 目的 | 主入力 | 主出力 | フォールバック / 補足 |
| --- | --- | --- | --- | --- | --- |
| ① テンプレ準備 | 自動 | ブランドに沿ったレイアウト資産化 | ブランドガイド、既存 PPTX | テンプレ PPTX (複数) | 後続工程で構造抽出可能な配置を徹底。版互換はリネームで管理。 |
| ② テンプレ構造抽出 | 自動 | レイアウト構造の機械可読化 | テンプレ PPTX | レイアウト構造 JSON、ヒントメタ | 不正 PH は除外、抽出不能要素は汎用 body 扱い。差分検出をログ化。 |
| ③ コンテンツ正規化 | HITL | 入力データをスライド素材へ変換し確定 | Markdown/CSV/JSON 等、ブリーフ | 承認済コンテンツ JSON | 自動案を提示し、人が文面・意図タグを確定。差戻しは再生成ログに記録。 |
| ④ ドラフト構成設計 | HITL | 章立て・ページ順序・layout_hint の確定 | 承認済コンテンツ JSON、制約 (枚数/章) | 承認済ドラフト JSON | 章構成案を提示し、人が順序・付録送りを決定。承認単位はスライド／章。 |
| ⑤ レイアウト割付 | 自動 | レイアウト選定と PH マッピング | 承認済ドラフト JSON、レイアウト構造 JSON | レンダリング準備 JSON | スコアリング優先度: 必須充足 ＞ 容量適合 ＞ 用途タグ ＞ 多様性。収容不能は縮約→分割→付録。 |
| ⑥ PPTX レンダリング | 自動 | 最終資料生成＋軽量整合チェック | レンダリング準備 JSON、テンプレ | output.pptx、生成ログ | 表は列幅調整で対応。空 PH・未使用要素はログ化し、必要に応じて削除。監査メタも併せて記録。 |

> **最終構成:** 6 工程で循環し、③・④ のみ人の承認を必須とする。承認済みデータ以外は自動工程に流さない。

## 3. フェーズ構成案

### フェーズA: テンプレートインテリジェンス（2025-10-12 〜 2025-11-08）
- 成果物: テンプレ構造抽出 CLI、レイアウト構造 JSON スキーマ、テンプレ資産の版管理フロー。
- KPI: レイアウト解析成功率 99% 以上、抽出処理 1 ファイルあたり 30 秒以内。
- 主タスク: RM-009/010 の統合、テンプレ差分検出、レイアウトメタ検証ツール。

### フェーズB: 自動パイプライン実装（2025-11-09 〜 2025-12-15）
- 成果物: ③・④ の HITL 承認ワークフロー、レイアウトスコアリングモジュール、縮約ポリシー。
- KPI: 30 枚資料を 60 秒以内で生成、縮約フォールバック成功率 90% 以上、承認1件あたりレビュー時間 5 分以内。
- 主タスク: RM-012〜RM-014、スコアリングルール実装、レンダリングログ整備、承認UI/API の整備。

### フェーズC: 品質・監査・運用（2025-12-16 〜 2026-01-31）
- 成果物: 軽量整合チェックの強化、Open XML Polisher 統合、監査レポート、再生成ワークフロー。
- KPI: 自動修正成功率 95%、監査ログ欠損 0%、再生成時間 5 分以内。
- 主タスク: RM-013/014 の仕上げ、監査ログ API、配布モードのメタマスク機能。

## 4. ロードマップアップデート方針
- `docs/roadmap/README.md` を上記フェーズへ再編し、RM-015「ロードマップ再設計」を新設する。
- 既存 RM は以下のように位置付け直す:
  - RM-009〜011 → フェーズA
  - RM-012〜014 → フェーズB 以降
  - 新規 RM-015 → フェーズ横断の戦略策定・ロードマップ管理
- フェーズ完了時には、対応する ToDo の完了判定と `docs/todo/archive/` への移動を自動化するスクリプトを検討。

## 5. リスクと対策
- **テンプレ互換性**: 抽出結果とレンダリングの差異が出た場合に備えて、テンプレ版ごとにゴールデンサンプルを保持する。
- **縮約ポリシーの品質**: 自動要約が品質を損なう場合に備え、優先度タグと分割ポリシーを細分化し、検出ログを蓄積。
- **処理時間**: 大規模テンプレ解析がボトルネックになった場合は差分解析とキャッシュ機構を導入する。
- **監査情報**: 配布モードでのメタ削除忘れを防ぐため、出力先に応じたプリセット設定（内部配布・外部配布）を提供する。

## 6. 次のアクション
1. テンプレ構造抽出 CLI の要件定義ドラフトを作成し、フェーズA の初動タスクを ToDo 化する。
2. レイアウトスコアリング指標（必須充足、容量適合、多様性）の定量化ルールを `docs/design/` に整理する。
3. 監査ログ項目の最小セット（source_id、template_version、content_hash）を `docs/requirements/` に反映する。
4. HITL 承認の状態遷移・権限設計を `docs/design/` に追記する。
