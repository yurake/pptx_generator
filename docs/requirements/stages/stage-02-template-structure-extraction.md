# 工程2 テンプレ構造抽出 要件詳細

## 概要
- テンプレ PPTX からレイアウト構造を機械抽出し、工程 3〜5 が利用できる JSON を生成する。
- 抽出処理は自動バッチで実行し、結果の妥当性検証と差分診断を行う。

## 入力
- 工程1で承認されたテンプレ PPTX。
- プレースホルダ種別マッピング表、面積→ヒント係数計算ルール。
- 既存レイアウトカタログ（過去バージョンとの差分照合に利用）。

## 出力
- `layouts.jsonl`: テンプレ ID、レイアウト ID、プレースホルダ一覧、テキスト/メディアヒント、用途タグ。
- `diagnostics.json`: 抽出警告・エラー、欠落レイアウト、フォールバック処理の記録。
- 差分レポート: 過去バージョンとの差異、命名変更、欠落 PH など。

## ワークフロー
1. 解析ジョブがテンプレ PPTX を取得し、スライドマスター配下のレイアウトを列挙する。
2. 各レイアウトのプレースホルダを抽出し、種別・面積・座標を付与する。
3. レイアウトカテゴリ・用途タグを決定し、ヒント係数を算出する。
4. JSON スキーマ検証を行い、欠落 PH や抽出不能項目を診断する。
5. 過去バージョンとの比較を行い、差分レポートを生成する。
6. 結果をアーカイブし、工程 3 以降に引き渡す。

## 品質ゲート
- `layouts.jsonl` がスキーマ検証に合格すること。
- プレースホルダ名の重複・欠落が検出された場合はエラー扱い。
- 用途タグとレイアウトカテゴリが未設定の場合は警告として記録。
- 差分レポートが存在しない場合でも、比較対象が無い旨を記録する。

## ログと監査
- 抽出処理時間、レイアウト数、警告件数を `diagnostics.json` に記録する。
- 解析失敗時はテンプレバージョンと原因を必ずログ化する。
- 差分レポートは工程1の `template_release.json` と突合し、変更理由を追跡可能にする。

## 未実装項目（機能単位）
- 抽出結果の JSON スキーマ検証 CLI (`extract-template` 拡張)。
- レイアウト差分レポートおよび警告の可視化 UI/レポート出力。
- 面積ベースのヒント係数と用途タグ推定ロジック。
